<Window x:Class="FileSizeAnalyzerGUI.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="FileSizeAnalyzer Pro" Height="600" Width="1000">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Input and Filter Section -->
        <StackPanel Orientation="Horizontal" Margin="10">
            <TextBox x:Name="DirectoryPathTextBox" Width="250" Margin="5"/>
            <Button Content="Browse" Click="BrowseButton_Click" Width="50" Margin="5"/>
            <ComboBox x:Name="SizeFilterComboBox" Width="100" Margin="5" SelectedIndex="0">
                <ComboBoxItem Content="All Sizes"/>
                <ComboBoxItem Content="> 1MB"/>
                <ComboBoxItem Content="> 10MB"/>
                <ComboBoxItem Content="> 100MB"/>
            </ComboBox>
            <ComboBox x:Name="ExtensionFilterComboBox" Width="100" Margin="5" SelectedIndex="0">
                <ComboBoxItem Content="All Types"/>
                <ComboBoxItem Content=".txt"/>
                <ComboBoxItem Content=".jpg"/>
                <ComboBoxItem Content=".mp4"/>
            </ComboBox>
            <ComboBox x:Name="DateFilterComboBox" Width="150" Margin="5" SelectedIndex="0">
                <ComboBoxItem Content="All Dates"/>
                <ComboBoxItem Content="Last Month"/>
                <ComboBoxItem Content="Last Year"/>
                <ComboBoxItem Content="Older Than 1 Year"/>
            </ComboBox>
            <Button x:Name="ScanButton" Content="Scan" Click="ScanButton_Click" Width="100" Visibility="Visible"/>
            <Button x:Name="StopScanButton" Content="Stop Scan" Click="StopScanButton_Click" Width="100" Visibility="Collapsed"/>
        </StackPanel>

        <!-- Progress Bar -->
        <ProgressBar x:Name="ScanProgressBar" Grid.Row="1" Height="20" Margin="10" Minimum="0" Maximum="100" Visibility="Collapsed"/>
        <TextBlock x:Name="ProgressTextBlock" Grid.Row="1" Margin="10" TextAlignment="Center" VerticalAlignment="Center" Visibility="Collapsed"/>

        <!-- Tabs for Results -->
        <TabControl Grid.Row="2" Margin="5">
            <TabItem Header="Directory Tree">
                <TreeView x:Name="DirectoryTreeView">
                    <TreeView.ItemTemplate>
                        <HierarchicalDataTemplate ItemsSource="{Binding Children}">
                            <StackPanel Orientation="Horizontal" Margin="2">
                                <!-- Bar Graph Representation -->
                                <Rectangle Height="15" 
                           Width="{Binding BarWidth}" 
                           Fill="{Binding BarFill}" 
                           ToolTip="{Binding FormattedSize, StringFormat='Size: {0}'}" 
                           Margin="0,0,5,0"/>
                                <!-- File/Folder Path -->
                                <TextBlock Text="{Binding FullPath}" Margin="0,0,10,0"/>
                                <!-- Formatted Size -->
                                <TextBlock Text="{Binding FormattedSize, StringFormat='({0})'}" Foreground="Gray"/>
                            </StackPanel>
                        </HierarchicalDataTemplate>
                    </TreeView.ItemTemplate>
                </TreeView>
            </TabItem>
            <TabItem Header="File List">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <DataGrid x:Name="ResultsDataGrid" AutoGenerateColumns="False" IsReadOnly="True" MouseDoubleClick="ResultsDataGrid_MouseDoubleClick" SelectionChanged="ResultsDataGrid_SelectionChanged">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Path" Binding="{Binding FullPath}" Width="*"/>
                            <DataGridTextColumn Header="Size (Bytes)" Binding="{Binding Size}" Width="100"/>
                            <DataGridTextColumn Header="Creation Time" Binding="{Binding CreationTime}" Width="150"/>
                            <DataGridTextColumn Header="Last Write Time" Binding="{Binding LastWriteTime}" Width="150"/>
                            <DataGridTextColumn Header="Extension" Binding="{Binding Extension}" Width="100"/>
                        </DataGrid.Columns>
                    </DataGrid>
                    <Border Grid.Column="1" Width="300" BorderBrush="Gray" BorderThickness="1" Margin="5">
                        <ScrollViewer>
                            <StackPanel x:Name="PreviewPanel" Margin="5">
                                <TextBlock Text="File Preview" FontWeight="Bold" Margin="0,0,0,5"/>
                                <Image x:Name="PreviewImage" Stretch="Uniform" MaxHeight="200" Visibility="Collapsed"/>
                                <TextBox x:Name="PreviewTextBox" IsReadOnly="True" TextWrapping="Wrap" Height="200" Visibility="Collapsed"/>
                                <TextBlock x:Name="PreviewMessage" Text="Select a file to preview" Foreground="Gray"/>
                            </StackPanel>
                        </ScrollViewer>
                    </Border>
                </Grid>
            </TabItem>
            <TabItem Header="Duplicates">
                <DataGrid x:Name="DuplicatesDataGrid" AutoGenerateColumns="False" IsReadOnly="True" MouseDoubleClick="DuplicatesDataGrid_MouseDoubleClick">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Path" Binding="{Binding FullPath}" Width="*"/>
                        <DataGridTextColumn Header="Size (Bytes)" Binding="{Binding Size}" Width="100"/>
                        <DataGridTextColumn Header="Duplicates" Binding="{Binding DuplicateCount}" Width="100"/>
                    </DataGrid.Columns>
                </DataGrid>
            </TabItem>
            <TabItem Header="Treemap">
                <Canvas x:Name="TreemapCanvas" SizeChanged="TreemapCanvas_SizeChanged"/>
            </TabItem>
            <TabItem Header="File Types">
                <DataGrid x:Name="FileTypesDataGrid" AutoGenerateColumns="False" IsReadOnly="True">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Type" Binding="{Binding Extension}" Width="*"/>
                        <DataGridTextColumn Header="Total Size (Bytes)" Binding="{Binding TotalSize}" Width="150"/>
                        <DataGridTextColumn Header="File Count" Binding="{Binding FileCount}" Width="100"/>
                    </DataGrid.Columns>
                </DataGrid>
            </TabItem>
            <TabItem Header="File Age">
                <DataGrid x:Name="FileAgeDataGrid" AutoGenerateColumns="False" IsReadOnly="True">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Age Category" Binding="{Binding Category}" Width="*"/>
                        <DataGridTextColumn Header="Total Size (Bytes)" Binding="{Binding TotalSize}" Width="150"/>
                        <DataGridTextColumn Header="File Count" Binding="{Binding FileCount}" Width="100"/>
                    </DataGrid.Columns>
                </DataGrid>
            </TabItem>
            <TabItem Header="Reports">
                <TextBox x:Name="ReportsTextBox" IsReadOnly="True" TextWrapping="Wrap" Margin="5"/>
            </TabItem>
            <TabItem Header="Scan History">
                <DataGrid x:Name="ScanHistoryDataGrid" AutoGenerateColumns="False" IsReadOnly="True" MouseDoubleClick="ScanHistoryDataGrid_MouseDoubleClick">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Scan Date" Binding="{Binding ScanDate}" Width="150"/>
                        <DataGridTextColumn Header="Path" Binding="{Binding Path}" Width="*"/>
                        <DataGridTextColumn Header="Total Size (Bytes)" Binding="{Binding TotalSize}" Width="150"/>
                    </DataGrid.Columns>
                </DataGrid>
            </TabItem>
        </TabControl>

        <!-- Export Button -->
        <Button Content="Export to CSV" Grid.Row="3" Click="ExportButton_Click" Width="100" HorizontalAlignment="Center" Margin="10"/>
    </Grid>
</Window>